<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>スマホ横スクロール ver:8</title>
<style>
 
  body {
    margin: 0;
    background: #222;
    overflow: hidden;
    touch-action: manipulation;
  }
  canvas {
    display: block;
    background: skyblue;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const playerImg = new Image();
playerImg.src = "player.png";

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// 画面サイズをスマホに合わせる
function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let gravity = 0.8;
let speed = 6;
let isGameOver = false;
let score = 0;
let scoreReal = 0;
let highScore = localStorage.getItem("highScore") || 0;

// プレイヤー
const player = {
  x: 50,
  y: 0,
  w: 40,
  h: 40,
  dy: 0,
  jump: -14,
  ground: false,
  jumpCount: 0
};

playerImg.onload = () => {
  const scale = 0.03; // ← 好きな大きさに調整
  player.w = playerImg.width * scale;
  player.h = playerImg.height * scale;
  loop();
};

let groundY;
let obstacles = [];

// タップ操作
document.addEventListener("touchstart", () => {
  if (isGameOver) {
    location.reload();
    return;
  }
  
  if (player.jumpCount < 3) {
    player.dy = player.jump;
    player.jumpCount++;
    player.ground = false;
  }
});

// 障害物生成
function createObstacle() {
  obstacles.push({
    x: canvas.width,
    y: groundY - 30,
    w: 30,
    h: 30
  });
}

function update() {
  if (isGameOver) return;

  scoreReal += 0.2;
  score = Math.floor(scoreReal);

  // ★ ハイスコア更新
  if (score > highScore) {
    highScore = score;
    localStorage.setItem("highScore", highScore);
  }

  groundY = canvas.height - 80;

  // プレイヤー
  player.dy += gravity;
  player.y += player.dy;

  if (player.y + player.h >= groundY) {
    player.y = groundY - player.h;
    player.dy = 0;
    player.ground = true;
    player.jumpCount = 0;
  }

  // 障害物
  obstacles.forEach(o => o.x -= speed);
  obstacles = obstacles.filter(o => o.x + o.w > 0);

  // 衝突
  obstacles.forEach(o => {
    if (
      player.x < o.x + o.w &&
      player.x + player.w > o.x &&
      player.y < o.y + o.h &&
      player.y + player.h > o.y
    ) {
      isGameOver = true;
    }
  });

  // ランダム生成
  if (Math.random() < 0.025) createObstacle();
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // スコア表示
  ctx.fillStyle = "black";
  ctx.font = "bold 24px sans-serif";
  ctx.fillText("SCORE : " + score, 20, 40);
 
  ctx.fillStyle = "black";
  ctx.font = "bold 20px sans-serif";
  ctx.fillText("HI : " + highScore, 20, 70);
  
  ctx.font = "20px sans-serif";
  ctx.fillText(
    "HI-SCORE : " + highScore,
    canvas.width / 2 - 90,
    canvas.height / 2 + 50
  );

  // 地面
  ctx.fillStyle = "green";
  ctx.fillRect(0, groundY, canvas.width, 80);

  // プレイヤー// プレイヤー（画像）
  ctx.drawImage(
    playerImg,
    player.x,
    player.y,
    player.w,
    player.h
  );

  // 障害物
  ctx.fillStyle = "black";
  obstacles.forEach(o => ctx.fillRect(o.x, o.y, o.w, o.h));

if (isGameOver) {
  ctx.fillStyle = "black";
  ctx.font = "bold 36px sans-serif";
  ctx.fillText(
    "GAME OVER",
    canvas.width / 2 - 110,
    canvas.height / 2 - 20
  );

  ctx.font = "20px sans-serif";
  ctx.fillText(
    "SCORE : " + score,
    canvas.width / 2 - 60,
    canvas.height / 2 + 20
  );

  ctx.font = "18px sans-serif";
  ctx.fillText(
    "タップでリスタート",
    canvas.width / 2 - 90,
    canvas.height / 2 + 60
  );
}
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

</script>
</body>
</html>
