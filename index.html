<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<style>
  :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif}
  body{margin:0;background:#0b1220;color:#eef;padding:20px;box-sizing:border-box}
  h1{font-size:18px;margin:0 0 12px}
  
  /* ●--------公開カード--------● */
  .board{
    display:flex;gap:12px;justify-content:center;margin-bottom:18px;
    flex-wrap:wrap;
  }
  .card{
    width:28vw; max-width:140px; height:40vw; max-height:200px;
    background:linear-gradient(180deg,#fff 0,#ddd 100%); color:#111;
    border-radius:8px; box-shadow:0 6px 14px rgba(0,0,0,.5);
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    user-select:none; touch-action: manipulation; cursor:pointer; position:relative;
    transition: transform .14s, box-shadow .14s, opacity .14s;
  }
  .card .title{font-weight:700;font-size:14px;margin-bottom:6px}                                                                    /* 公開カードタイトル   */
  .card .txt{font-size:12px; text-align:center; padding:0 6px}                                                                      /* 公開カードテキスト   */
  .card .tag{position:absolute; top:8px; right:8px; background:#222;color:#fff;font-size:11px;padding:4px 6px;border-radius:6px;}   /* 公開カードタグ：選ぶ */

  /* ●--------ボタン--------● */
  .info{display:flex;gap:12px;align-items:center;justify-content:center;margin-bottom:12px;flex-wrap:wrap}  /* ボタンの大枠 */
  button{font-size:14px;padding:8px 12px;border-radius:8px;border:0;background:#2a8; color:#052; font-weight:700; cursor:pointer}  /* ボタン */

  /* ●--------デッキ--------● */
  .deck{
    max-width:720px;margin:0 auto;background:rgba(255,255,255,0.04);padding:12px;border-radius:8px; /* デッキ大枠 */
  }
  .deckList{display:flex;flex-wrap:wrap;gap:8px}  /* デッキリスト枠 */
  .mini{background:#fff;color:#111;padding:6px 8px;border-radius:6px;font-size:13px;box-shadow:0 4px 8px rgba(0,0,0,.4)} /* デッキカード */
  
  /* ●--------スマホ対応--------● */
  @media(min-width:700px){
    .card{width:160px;height:220px}
  }
</style>
</head>

<body>
<!-- ■■■■■■■■■■■■■■■■■■■■■■■■■■■ -->
<!-- ■    画面構成              ■ -->
<!-- ■■■■■■■■■■■■■■■■■■■■■■■■■■■ -->
<h1>Ver：15</h1>
<!-- ●--------ボタン：リセット--------● -->
<div class="info">
  <button id="resetBtn">場をリセット</button>
</div>

<!-- ●--------公開カード--------● -->
<div class="board" id="board"></div>

<!-- ●--------デッキ--------● -->
<div class="deck">
  <div class="deckList" id="deckList"></div>
</div>

<!-- ●--------ボタン：カードを引く--------● -->
<button id="drawBtn">カードを引く</button>

<script>
// ■■■■■■■■■■■■■■■■■■■■■■■■■■■
// ■    変数・定数            ■
// ■■■■■■■■■■■■■■■■■■■■■■■■■■■
// ●--------カードプール--------●
const CARD_POOL = [
  { id: 'c1', name: '斬撃の剣', text: '敵1体に2ダメージ' },
  { id: 'c2', name: '回復ハーブ', text: '自分を3回復' },
  { id: 'c3', name: '防御の盾', text: '1ターン防御＋2' },
  { id: 'c4', name: '爆裂の書', text: '全体に1ダメージ' },
  { id: 'c5', name: '強化薬', text: '次の攻撃+2' },
  { id: 'c6', name: '召喚:ゴブリン', text: 'ゴブリンを1体召喚' },
  { id: 'c7', name: '土の鎧', text: '自身の防御3（持続）' },
  { id: 'c8', name: '雷の一撃', text: '敵1体に4ダメージ（確率）' },
];

// ●--------状態--------●
let boardCards    = [];   // 公開カード
let a_deck        = [];   // デッキ
let pv_hand       = [];   // 手札
const boardEl      = document.getElementById('board');
const cardsLeftEl  = document.getElementById('cardsLeft');
const deckListEl   = document.getElementById('deckList');

// ■■■■■■■■■■■■■■■■■■■■■■■■■■■
// ■    初期表示              ■
// ■■■■■■■■■■■■■■■■■■■■■■■■■■■
dealBoard();  // 場に3枚出す
renderDeck(); // デッキ描画

// ▼▼▼▼▼▼▼▼▼ ボタン動作 ▼▼▼▼▼▼▼▼▼
// ●--------公開カードリセットボタン--------●
document.getElementById('resetBtn').addEventListener('click', ()=> { dealBoard(); });

// ●--------カード引くボタン--------●
document.getElementById("drawBtn" ).addEventListener("click", drawCard);

// ▼▼▼▼▼▼▼▼▼ モジュール ▼▼▼▼▼▼▼▼▼ 
// ●--------場に3枚出す--------●
function dealBoard(){
  const pool = shuffle( CARD_POOL.slice() );       // カード一覧をコピーしてシャッフル
  boardCards = pool.slice(0,3).map(c => ({...c})); // 場に３枚並べる
  renderBoard(); // 場を描画
}

// ●--------カードをピック--------●
function pickCard(idx){
  const [card] = boardCards.splice(idx,1); // 場から取り除く
  a_deck.unshift(card);
  renderBoard(); // 場を描画
  renderDeck();  // デッキ描画
}

// ●--------カードを引く--------●
function drawCard(){
  const card = deck.shift(); // 先頭を取り出す
  pv_hand.push(card);           // 手札に追加
}

// ●--------場を描画--------●
function renderBoard(){
  boardEl.innerHTML = ''; // 場を初期化
  // 公開カードを描画
  boardCards.forEach((c, fv_idx) => {
    const cardEl = document.createElement('div');
    cardEl.className = 'card';
    cardEl.dataset.idx = fv_idx;
    cardEl.innerHTML = `
      <div class="tag">選ぶ</div>
      <div class="title">${c.name}</div>
      <div class="txt">${c.text}</div>
    `;
    // タップ、クリックで選択
    cardEl.addEventListener('click',      ()=> pickCard(fv_idx));
    cardEl.addEventListener('touchstart', ()=> pickCard(fv_idx));
    boardEl.appendChild(cardEl); // 場を描画
  });

  // 場が空ならメッセージ
  if(boardCards.length===0){
    const msg = document.createElement('div');
    msg.style.color='#fff';
    msg.style.opacity='0.9';
    msg.textContent = '場にカードがありません（リセットで補充）';
    boardEl.appendChild(msg);
  }
}

// ●--------デッキ描画--------●
function renderDeck(){
  deckListEl.innerHTML = ''; // デッキリストをクリア
  // デッキリストが０の場合
  if(a_deck.length===0){
    deckListEl.innerHTML = '<div>デッキ：空</div>';
    return;
  }
  // デッキリストを描画
  a_deck.forEach( ( c, i ) => {
    const el = document.createElement('div');
    el.className   = 'mini';
    el.textContent = `${i+1}. ${c.name}`;
    deckListEl.appendChild(el);
  });
}

// ●--------配列をシャッフル--------●
function shuffle( arr ) {
  for( let i = arr.length - 1; i > 0; i-- ) {
    const j = Math.floor( Math.random() * (i+1) );
    [ arr[i], arr[j] ] = [ arr[j], arr[i] ];
  }
  return arr;
}

</script>
</body>
</html>
